@model MySportsBook.Model.Master_Batch
@{

    ViewBag.Title = "Index";
    if (ViewContext.ViewBag.IsAdmin != null && ViewContext.ViewBag.IsAdmin)
    {
        Layout = "/Views/Shared/Layout/_AdminLayout.cshtml";
    }
    else
    {
        Layout = "/Views/Shared/Layout/_Layout.cshtml";
    }
}


<main class="main">
    <!-- Breadcrumb-->
    <ol class="breadcrumb">
        <li class="breadcrumb-item">Home</li>
        <li class="breadcrumb-item">@Html.ActionLink("Batch", "")</li>
        <li class="breadcrumb-item active">Create</li>
    </ol>
    <div class="container-fluid">
        <div class="animated fadeIn">
            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()
                <div class="row">
                    <div class="col-md-7">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <strong>Create</strong>
                                    </div>
                                    <div class="col-sm-8">
                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.BatchCode, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.BatchCode, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.BatchCode, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.BatchName, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.BatchName, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.BatchName, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.MaxPlayers, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.MaxPlayers, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.MaxPlayers, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.Label("Sport", htmlAttributes: new { @class = "control-label" })
                                            @Html.DropDownList("Sport", null, htmlAttributes: new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.FK_CourtId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.FK_CourtId, "Court", htmlAttributes: new { @class = "control-label" })
                                            @Html.DropDownList("Court", null, htmlAttributes: new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.FK_CourtId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.Fee, htmlAttributes: new { @class = "control-label" })
                                            @Html.EditorFor(model => model.Fee, new { htmlAttributes = new { @class = "form-control" } })
                                            @Html.ValidationMessageFor(model => model.Fee, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.StartDate, htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control date" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-calendar"></i>
                                                    </span>
                                                </div>
                                            </div>
                                            @Html.ValidationMessageFor(model => model.StartDate, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.EndDate, htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control date" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-calendar"></i>
                                                    </span>
                                                </div>
                                            </div>
                                            @Html.ValidationMessageFor(model => model.EndDate, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.Label("Attendance Required", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBoxFor(model => model.IsAttendanceRequired)
                                                    @Html.ValidationMessageFor(model => model.IsAttendanceRequired, "", new { @class = "text-danger" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.FK_BatchTypeId, "Batch Type", htmlAttributes: new { @class = "control-label" })
                                            @Html.DropDownList("BatchType", null, htmlAttributes: new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.FK_BatchTypeId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                    <div class="col-sm-4 coach-div">
                                        <div class="form-group">
                                            @Html.LabelFor(model => model.FK_CoachId, "FK_CoachId", htmlAttributes: new { @class = "control-label" })
                                            @Html.DropDownList("Coach", null, htmlAttributes: new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.FK_CoachId, "", new { @class = "text-danger" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                @Html.Partial("~/Views/Shared/Button/_SaveButton.cshtml")
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="card">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-sm-9">
                                        <strong>Timing</strong>
                                    </div>
                                    <div class="col-sm-3">
                                        <i class="fa fa-list-alt float-right"> @Html.ActionLink("Back to List", "")</i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Monday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Monday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("MonStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("MonEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Tuesday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Tuesday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("TueStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("TueEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Wednesday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Wednesday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("WedStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("WedEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Thursday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Thursday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("ThuStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("ThuEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Friday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Friday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("FriStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("FriEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Saturday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Saturday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("SatStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("SatEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row time-row">
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            @Html.Label("Sunday", htmlAttributes: new { @class = "control-label" })
                                            <div class="col-md-10">
                                                <div class="checkbox">
                                                    @Html.CheckBox("Sunday", htmlAttributes: new { @class = "week" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("Start Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("SunStartTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="form-group">
                                            @Html.Label("End Time", htmlAttributes: new { @class = "control-label" })
                                            <div class="input-group">
                                                @Html.Editor("SunEndTime", new { htmlAttributes = new { @class = "form-control time" } })
                                                <div class="input-group-append">
                                                    <span class="input-group-text">
                                                        <i class="fa fa-clock-o"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</main>
@Html.Partial("~/Views/Shared/Script/_DateTimePicker.cshtml")

<script>
    $('#Sport').change(function () {
        loader();
        $.ajax({
            type: "POST",
            url: "/DropDown/GetCourt",
            data: { sportid: $('#Sport').val() },
            datatype: "json",
            traditional: true,
            success: function (data) {
                loader();
                var batch = '';
                for (var i = 0; i < data.length; i++) {
                    batch = batch + '<option fee=' + data[i].Fee + ' value=' + data[i].Value + '>' + data[i].Text + '</option>';
                }
                $('#Court').html(batch);
            },
            error: function (jqXHR, exception) {
                loader();
            }
        });
    });
    $('#Court').change(function (e) {
        $('#Fee').val($('option:selected', this).attr('fee') == undefined ? "0.00" : parseFloat($('option:selected', this).attr('fee')).toFixed(2));
    });

    $('#BatchType').change(function () {
        showCoach();
    });

    function validate() {
        if (new Date(parseTime($('input[name="StartTime"]').val())).toTimeString().substring(0, 8) > new Date(parseTime($('input[name="EndTime"]').val())).toTimeString().substring(0, 8) || new Date(parseTime($('input[name="StartTime"]').val())).toTimeString().substring(0, 8) == new Date(parseTime($('input[name="EndTime"]').val())).toTimeString().substring(0, 8)) {
            swal("Failed!", "Start Time should be less than End time!", "error");
        }
        else if (new Date($('input[name="StartDate"]').val()) != new Date($('input[name="EndDate"]').val()) && new Date($('input[name="StartDate"]').val()) > new Date($('input[name="EndDate"]').val())) {
            swal("Failed!", "Start date should be less than End date!", "error");
        }
    }

    function save() {
        var batchTimings = [];
        $('.week').each(function () {
            if ($(this).is(":checked")) {
                batchTimings.push({
                    WeekDay: $(this).attr('name').trim(),
                    StartTime: new Date(parseTime($(this).closest('.time-row').find('input[name*="Start"]').val())).toTimeString().substring(0, 8),
                    EndTime: new Date(parseTime($(this).closest('.time-row').find('input[name*="End"]').val())).toTimeString().substring(0, 8),
                });
            }
        });
        if (batchTimings.length > 0) {
            var batchmodel = {
                BatchCode: $('input[name="BatchCode"]').val(),
                BatchName: $('input[name="BatchName"]').val(),
                SportId: $('select[name="Sport"]').val(),
                CourtId: $('select[name="Court"]').val(),
                BatchTypeId: $('select[name="BatchType"]').val(),
                Fee: $('input[name="Fee"]').val(),
                MaxPlayers: $('input[name="MaxPlayers"]').val(),
                CoachId: $('select[name="Coach"]').val(),
                StartDate: new Date($('input[name="StartDate"]').val()),
                EndDate: new Date($('input[name="EndDate"]').val()),
                AttendanceRequired: $('input[name="IsAttendanceRequired"]').is(":checked"),
                BatchTimings: batchTimings
            }
            saveData(batchmodel, $('input[name="BatchName"]').val(), SaveOrUpdate.save);
        }
        else {
            swal("Failed!", "Please add atleast one day!", "error", {
                icon: "error"
            });
        }
    }

    function showCoach() {
        if ($('#BatchType').val() == 1) {
            $('.coach-div').hide();
        }
        else {
            $('.coach-div').show();
        }
    }
    $('.time').prop("disabled", true);
    $('.week').change(function () {
        if ($(this).is(":checked")) {
            //TO GET THE VALUE FROM THE PREVIOUS DAY
            $(this).closest('.time-row').find('input[type=text]').removeAttr("disabled");

            var _shouldcontinue = true;
            var _previousdiv = $(this).closest('.time-row').prev();
            var _currdiv = $(this).closest('.time-row');

            while (_shouldcontinue) {
                if (_previousdiv.length > 0) {
                    if ($(_previousdiv).find('input[type=checkbox]:checked').length > 0) {
                        $(_previousdiv).find('input[type=text]').each(function () {

                            if ($(this).attr('name').toLowerCase().indexOf('starttime') > -1) {
                                $(_currdiv).find('input[name*="Start"]').val($(this).val());
                            }
                            if ($(this).attr('name').toLowerCase().indexOf('endtime') > -1) {
                                $(_currdiv).find('input[name*="End"]').val($(this).val());
                            }
                        });
                        _previousdiv = [];
                        _shouldcontinue = false;
                    }
                    else {
                        _previousdiv = $(_previousdiv).prev();
                    }
                }
                else {
                    _previousdiv = [];
                    _shouldcontinue = false;
                }
            }
        }
        else {
            $(this).closest('.time-row').find('input[type=text]').val('');
            $(this).closest('.time-row').find('input[type=text]').prop("disabled", true);
        }
    });
    showCoach();
</script>
